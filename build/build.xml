<project name="JPT" default="dist" basedir="..">
  <description>
  Build file for the Java Permutation Tools (JPT) API.
  </description>
  <!-- global properties for this build -->
  <property name="VERSION" value="1"/>
  <property name="junit" location="build/junit-4.12.jar"/>
  <property name="hamcrest" location="build/hamcrest-core-1.3.jar"/>
  <property name="src" location="src"/>
  <property name="bin" location="bin"/>
  <property name="testsrc" location="tests"/>
  <property name="testbin" location="testbin"/>
  <property name="dist" location="lib"/>
  
  <target name="init">
    <!-- Create the time stamp -->
    <tstamp/>
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${bin}"/>
	<!-- Create the test directory structure-->
	<mkdir dir="${testbin}"/>
	<!-- Create the distribution directory -->
    <mkdir dir="${dist}"/>
  </target>
  
  <target name="compile" depends="init"
        description="compile the source">
    <!-- Compile the Java code from ${src} into ${bin} -->
    <javac srcdir="${src}" destdir="${bin}"/>
	<!-- Compile the JUnit tests from ${testsrc} into ${testbin} -->
	<javac srcdir="${testsrc}" destdir="${testbin}" classpath="${junit};${bin}"/>	
  </target>
  
  <target name="test" depends="compile"
        description="execute JUnit tests">
	<junit haltonfailure="on">
	  <formatter type="plain" usefile="false"/>
	    <classpath>
          <pathelement location="${junit}"/>
		  <pathelement location="${hamcrest}"/>
          <pathelement location="${bin}"/>
          <pathelement location="${testbin}"/>
	    </classpath>
		<batchtest>
          <fileset dir="${testbin}">
            <include name="**/*.class"/>
          </fileset>
        </batchtest>
	</junit>
  </target>
  
  <target name="dist" depends="compile,test"
        description="generate the distribution">
    <!-- Put everything in ${bin} into the jpt${VERSION}.jar file -->
    <jar jarfile="${dist}/jpt${VERSION}.jar" basedir="${bin}"/>
  </target>
  
  <target name="clean"
        description="clean up">
    <!-- Delete the ${bin} and ${dist} directory trees -->
    <delete dir="${bin}"/>
	<delete dir="${testbin}"/>
    <delete dir="${dist}"/>
  </target>

</project>